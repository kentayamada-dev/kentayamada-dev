import { ImageResponse } from 'next/og';
import { contentfulType } from '@/constants/contentful';
import { getMetadata } from '@/lib/graphql-request';
import { OG } from '@/lib/nextjs';
import { getGoogleFont, throwColoredError } from '@/utils';
import type { UtilityImageType } from '@/types/components';

const STOCK_PROFIT_CALCULATOR_ID = contentfulType.metadata.stockProfitCalculator;
const FONT_NAME = 'Noto Sans JP';
const FONT_BOLD = 700;
const FONT_REGULAR = 400;

const Image: UtilityImageType = async (props) => {
  const { locale } = await props.params;
  const metadata = await getMetadata(locale, STOCK_PROFIT_CALCULATOR_ID);

  if (metadata === null) {
    return throwColoredError(`metadata <${STOCK_PROFIT_CALCULATOR_ID}> is empty`, 'red');
  }

  const title = metadata.title.toUpperCase();

  return new ImageResponse(
    (
      <div
        style={{
          alignItems: 'center',
          backgroundImage: 'linear-gradient(90deg, rgba(23, 115, 244, 1), rgba(14, 244, 255, 1))',
          display: 'flex',
          fontFamily: FONT_NAME,
          height: '100%',
          justifyContent: 'center',
          textAlign: 'center',
          width: '100%'
        }}
      >
        <div
          style={{
            background: 'white',
            borderRadius: '1rem',
            boxShadow: '0px 4px 16px rgba(17,17,26,0.1), 0px 8px 24px rgba(17,17,26,0.1), 0px 16px 56px rgba(17,17,26,0.1)',
            display: 'flex',
            height: '87%',
            justifyContent: 'center',
            padding: '3rem',
            width: '90%'
          }}
        >
          <div
            style={{
              alignItems: 'center',
              display: 'flex',
              flexDirection: 'column'
            }}
          >
            <span
              style={{
                fontSize: locale === 'ja' ? '7rem' : '4.3rem',
                fontWeight: FONT_BOLD,
                letterSpacing: '-0.025em',
                marginTop: locale === 'ja' ? '0' : '4rem'
              }}
            >
              {title}
            </span>
            <span
              style={{
                fontSize: locale === 'ja' ? '2rem' : '1.7rem',
                marginTop: '2.5rem'
              }}
            >
              {metadata.description}
            </span>
            <span
              style={{
                justifyContent: 'flex-end',
                marginTop: 'auto',
                width: '100%'
              }}
            >
              <svg fill='black' height='80' viewBox='-5 -5 160 110'>
                <path d='M99.601 50.7a10 10 0 0 0 .236 2.265q.726 3.073 3.685 3.618a7.6 7.6 0 0 0 1.379.117 9.73 9.73 0 0 0 5.955-2.093q2.306-1.735 4.345-4.907 1.2-5.3 4.55-18.4a1798 1798 0 0 0 1.16-4.557q2.121-8.385 2.702-11.115l.088-.428a71 71 0 0 1 .847-3.453q.484-1.77 1.01-3.257a29 29 0 0 1 1.093-2.69 10 10 0 0 1 .82-1.448q.506-.733 1.076-1.205a3.46 3.46 0 0 1 2.254-.847 16.6 16.6 0 0 1 2.665.2q1.432.234 2.579.74a7.5 7.5 0 0 1 1.806 1.11 5.8 5.8 0 0 1 1.587 2.21q.863 2.014.863 5.19a19.2 19.2 0 0 1-.664 4.847q-.552 2.114-1.561 4.399a40 40 0 0 1-1.375 2.804 594 594 0 0 1-.956 5.569l-.344 1.931q-.7 3.9-1.8 10.2-1.013 5.802-3.637 19.066l-.463 2.334a136 136 0 0 0 4.725-2.018q6.459-2.92 8.942-5.1a8 8 0 0 0 .783-.782 23 23 0 0 1 1.067-1.17q1.68-1.707 2.8-1.904a1.6 1.6 0 0 1 .283-.026 1.18 1.18 0 0 1 1.095.716q.405.774.405 2.384a8.7 8.7 0 0 1-.652 3.399 8.3 8.3 0 0 1-1.198 2.001 19 19 0 0 1-1.44 1.574q-1.706 1.678-4.36 3.626-2.978 2.187-9.678 5.282A188 188 0 0 1 127.501 73a67 67 0 0 1-3.369 10.637Q118.636 96.741 108.501 101q-3.8 1.6-8 1.6a39 39 0 0 1-5.629-.383q-2.898-.427-5.279-1.328a18 18 0 0 1-3.392-1.689 12.8 12.8 0 0 1-4.262-4.182q-1.522-2.486-1.783-5.736a17 17 0 0 1-.055-1.382 6.12 6.12 0 0 1 1.582-3.832q3.317-4.084 13.59-8.446a122 122 0 0 1 4.828-1.922 1084 1084 0 0 1 3.473-1.278q6.157-2.254 8.187-2.889a19 19 0 0 1 .44-.133 30 30 0 0 1 .049-1.636q.106-1.92.44-4.481l.011-.083q-6.2 3.5-13.55 3.5-5.906 0-9.455-2.873a11.4 11.4 0 0 1-1.595-1.577 15 15 0 0 1-2.832-5.479q-.868-2.993-.868-6.771a25 25 0 0 1 .429-4.507 32 32 0 0 1 .821-3.393q1.25-4.2 2.8-8.55t2.8-8.55a32 32 0 0 0 .928-3.989 24 24 0 0 0 .322-3.811q0-6.7-4.1-6.7-1.4 0-2.55.8t-2.3 1.7-2.35 1.7a4.8 4.8 0 0 1-2.504.795 6 6 0 0 1-.246.005q-1.452 0-1.544-2.37a9 9 0 0 1-.006-.33 10.1 10.1 0 0 1 3.614-7.842A15 15 0 0 1 82.001 3.8 18.5 18.5 0 0 1 91.168.332 24 24 0 0 1 93.701.2a14.6 14.6 0 0 1 4.268.589 10.8 10.8 0 0 1 5.932 4.411q2.6 3.7 2.6 8.4t-1.1 9.05a522 522 0 0 1-2.194 8.376l-.156.574q-1.25 4.6-2.35 9.35t-1.1 9.75m-25.364 1.547a1.19 1.19 0 0 0-1.036-.647 1 1 0 0 0-.305.058q-.613.209-1.636 1.18a19 19 0 0 0-.709.712q-1.85 1.95-4.15 4.25a74 74 0 0 1-.576.57 67 67 0 0 1-4.074 3.68 16 16 0 0 1-.454.364Q59.235 64 57.701 64a2.44 2.44 0 0 1-1.441-.471q-.785-.559-1.409-1.779a20 20 0 0 1-.482-1.017q-.45-1.02-.858-2.225a39 39 0 0 1-.71-2.358q-.9-3.35-1.9-7.3a43 43 0 0 0-.61-2.17 36 36 0 0 0-1.99-5.08q9-5.1 15.9-15.2l.103-.15a53 53 0 0 0 5.297-9.75q1.214-2.948 1.727-5.512a18 18 0 0 0 .373-3.538 25 25 0 0 0-.026-1.158q-.142-3.06-1.074-4.542-1.1-1.75-3.8-1.75h-.119q-1.781.004-3.097.118a18 18 0 0 0-1.134.132l-.098.016q-.469.081-.841.242A2.2 2.2 0 0 0 60.301 1.7l-.249.599a1168 1168 0 0 0-3.601 8.751q-1.85 4.55-3.85 8.85a84 84 0 0 1-1.195 2.451q-1.82 3.58-3.801 6.579a47 47 0 0 1-4.804 6.17 8 8 0 0 0-1.971-.851 9.6 9.6 0 0 0-2.629-.349 12 12 0 0 0-1.457.084 9.9 9.9 0 0 0-3.193.916 5 5 0 0 0-.45.25q-1.6 1.012-1.6 3a4.45 4.45 0 0 0 .762 2.539 5.7 5.7 0 0 0 1.188 1.261q1.95 1.55 4.55 2.05l.037.128q1.082 3.831 2.163 13.222 1.1 9.55 2.8 12.95l.115.223a9.6 9.6 0 0 0 3.185 3.577q1.444.963 3.644 1.264a16 16 0 0 0 2.156.136 16.2 16.2 0 0 0 4.167-.568 22 22 0 0 0 3.633-1.332q4.1-1.9 7.45-4.85a30 30 0 0 0 1.017-.936 26.4 26.4 0 0 0 4.433-5.564q2.1-3.55 2.1-6.05a22 22 0 0 0-.01-.686q-.072-2.323-.654-3.267M35.201 3.3h.2a1.8 1.8 0 0 1 .451.067q.611.164 1.499.733 1.25.8 1.25 2.6 0 1.621-.527 3.606a21 21 0 0 1-.123.444q-.443 1.536-1.096 2.536a5 5 0 0 1-.654.814 51 51 0 0 1-.647 3.867q-.703 3.446-1.953 7.633-2 6.7-4.2 14.3a216 216 0 0 0-2.831 10.906q-2.369 10.308-2.711 17.612a51 51 0 0 0-.058 2.382 4.75 4.75 0 0 1-2.965 4.471Q17.961 76.7 12.301 76.7q-2.5 0-2.95-2.55a24 24 0 0 1-.237-1.774q-.183-1.848-.209-4.342a81 81 0 0 1-.004-.834q0-6.668 2.706-18.327a230 230 0 0 1 1.794-7.173 276 276 0 0 1 3.106-10.827q1.488-4.789 2.986-8.858a114 114 0 0 1 3.008-7.415 47 47 0 0 0-5.591.413q-6.338.876-10.103 3.563a14 14 0 0 0-.306.224 42 42 0 0 0-1.115.865q-.524.421-.961.806a19 19 0 0 0-.524.479q-.827.786-1.483.922a1.3 1.3 0 0 1-.267.028 1.1 1.1 0 0 1-.609-.195q-.371-.241-.728-.777a5 5 0 0 1-.113-.178 4.7 4.7 0 0 1-.609-1.658A6.3 6.3 0 0 1 .001 18q0-4.928 3.934-7.849a13 13 0 0 1 .966-.651 31.5 31.5 0 0 1 5.793-2.657q2.922-1.023 6.449-1.759A80 80 0 0 1 24.801 3.9q5.7-.6 10.4-.6m68 90.3q4-3.3 6.8-14a445 445 0 0 1-3.75 1.327q-2.937 1.023-5.25 1.773a126 126 0 0 0-1.768.588q-2.45.834-4.215 1.564l-.117.048a24 24 0 0 0-1.31.59q-1.416.692-2.19 1.36a3.5 3.5 0 0 0-.686.787 2.7 2.7 0 0 0-.414 1.463q0 2.271 2.475 3.799a10 10 0 0 0 .525.301 16 16 0 0 0 2.478 1.074q1.493.492 2.904.565a10 10 0 0 0 .318.011l.199.002q1.963 0 3.271-.738a4.5 4.5 0 0 0 .73-.514' />
              </svg>
            </span>
          </div>
        </div>
      </div>
    ),
    {
      fonts: [
        {
          data: await getGoogleFont(
            `https://fonts.googleapis.com/css2?family=${FONT_NAME.replace(/\s/gu, '+')}:wght@${FONT_BOLD}&text=${encodeURIComponent(title)}`
          ),
          name: FONT_NAME,
          weight: FONT_BOLD
        },
        {
          data: await getGoogleFont(
            `https://fonts.googleapis.com/css2?family=${FONT_NAME.replace(/\s/gu, '+')}:wght@${FONT_REGULAR}&text=${encodeURIComponent(metadata.description)}`
          ),
          name: FONT_NAME,
          weight: FONT_REGULAR
        }
      ],
      height: OG.SIZE.HEIGHT,
      width: OG.SIZE.WIDTH
    }
  );
};

export { Image as default };
